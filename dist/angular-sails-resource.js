var bind=function(t,e){return function(){return t.apply(e,arguments)}};angular.module("sailsService",["ngSails","angular-underscore"]).config(["$sailsProvider",function(t){return t.url=this.location.origin}]).factory("SailsResource",["$sails","$rootScope",function(t,e){var r;return r=function(){function r(e,r){this.identity=e,null==r&&(r={}),this.removedFrom=bind(this.removedFrom,this),this.addedTo=bind(this.addedTo,this),this.destroyed=bind(this.destroyed,this),this.updated=bind(this.updated,this),this.created=bind(this.created,this),this.prefix=r.prefix||"",this.apiModelUrl=this.prefix+"/"+this.identity,this.resources=[],this.resource={},t.on(this.identity,function(t){return function(e){return console.log("on "+t.identity,e),t[e.verb](e)}}(this))}return r.prototype.emit=function(t,r){return e.$emit(this.identity+":"+t,r)},r.prototype.created=function(t){return this.resources.push(t.data),this.emit("created",t.data)},r.prototype.updated=function(t){var e;return e=this.find({id:t.id}),e&&_.extend(e,t.data),null!=this.resource.id&&this.resource.id===t.id&&_.extend(this.resource,t.data),this.emit("updated",t.data)},r.prototype.destroyed=function(t){var e,r;return r=this.resources,e=_.findWhere(r,{id:t.id}),e&&r.splice(r.indexOf(e),1),this.emit("destroyed",t.data)},r.prototype.addedTo=function(t){return this.getRequest(t)},r.prototype.removedFrom=function(t){return this.getRequest(t)},r.prototype.getRequest=function(t){var e,r;return e=function(t){return function(e,r){return t.get(e.id,function(i){return _.extend(e,i),t.emit(r,i)})}}(this),null!=this.resource&&this.resource.id&&e(this.resource,t.verb),this.resources.length?(r=_.findWhere(this.resources,{id:t.id}),e(r,t.verb)):void 0},r.prototype.find=function(t){return _.findWhere(this.resources,t)},r.prototype.cleanupAngularObject=function(t){return angular.fromJson(angular.toJson(t))},r.prototype.query=function(e,r){return t.get(this.apiModelUrl,e).success(function(t){return function(e){return"object"==typeof e&&(t.resources=e),r?r(e):void 0}}(this)).error(function(t){throw t})},r.prototype.get=function(e,r){return t.get(this.apiModelUrl+"/"+e).success(function(t){return function(e){return t.resource=e,r?r(e):void 0}}(this)).error(function(t){throw t})},r.prototype.create=function(e,r){return t.post(this.apiModelUrl,this.cleanupAngularObject(e)).success(function(t){return function(e){return t.resources.push(e),r?r(e):void 0}}(this)).error(function(t){throw t})},r.prototype.update=function(e,r,i){return t.put(this.apiModelUrl+"/"+r,this.cleanupAngularObject(e)).success(function(t){return i?i(t,r):void 0}).error(function(t){throw t})},r.prototype["delete"]=function(e,r){return t["delete"](this.apiModelUrl+"/"+e,obj).success(function(t){return function(e){return t.destroyed(e,t),r?r(e):void 0}}(this)).error(function(t){throw t})},r.prototype.addTo=function(t,e,r){return this.postRequest(this.apiModelUrl+"/"+e+"/"+r,t)},r.prototype.removeFrom=function(t,e,r,i){return this.postRequest(this.apiModelUrl+"/"+e+"/"+r+"/"+i,t)},r.prototype.postRequest=function(e,r){return t.post(e,this.cleanupAngularObject(r)).success(function(t){return function(e){return t.resource=e,cb?cb(e):void 0}}(this)).error(function(t){throw t})},r}()}]);